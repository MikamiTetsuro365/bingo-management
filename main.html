<!DOCTYPE html>
<html lang="ja" class="h-100">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>超ビンゴ</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/sticky-footer-navbar.css" rel="stylesheet">
  </head>
  <body class="d-flex flex-column h-100">
    <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="https://getbootstrap.jp/docs/4.3/examples/sticky-footer-navbar/#">超ビンゴォ</a>
      </nav>
    </header>

    <!-- Begin page content -->
    <main role="main" class="flex-shrink-0">
      <div class="container">

          <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">ビンゴ！</h5>
                </div>
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary modal-close-button" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

        <div class="row mb-2">
              <button type="button" id="initButton" class="btn btn-danger col-md-3">初期化</button>
        </div>
        <div class="row mb-2">
            <button type="button" id="number1" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">1</button>
            <button type="button" id="number2" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">2</button>
            <button type="button" id="number3" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">3</button>
            <button type="button" id="number4" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">4</button>
            <button type="button" id="number5" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">5</button>
            <button type="button" id="number6" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">6</button>
            <button type="button" id="number7" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">7</button>
            <button type="button" id="number8" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">8</button>
            <button type="button" id="number9" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">9</button>
            <button type="button" id="number10" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">10</button>
            <button type="button" id="number11" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">11</button>
            <button type="button" id="number12" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">12</button>
            <button type="button" id="number13" class="number-btn btn btn-primary col-md-1 mr-1 mb-1">13</button>
        </div>
        <div class="all-bingo-card row">
        </div>

      </div>
    </main>
    <script>
    $(function(){

      //走査列
      var scanLine = [
          [0, 1, 2],
          [0, 3, 6],
          [6, 7, 8],
          [2, 5, 8],
          [1, 4, 7],
          [3, 4, 5],
          [0, 4, 8],
          [2, 4, 6]
      ];

    　//ビンゴカード
      var arr = [
          [1, 2, 3, 4, 5, 6, 7, 8, 9],
          [9, 8, 7, 6, 5, 4, 3, 2, 1],
          [2, 1, 3, 5, 4, 8, 7, 9, 6],
          [4, 3, 6, 1, 5, 2, 7, 8, 9],
          [1, 3, 8, 5, 4, 6, 2, 7, 9],
          [2, 3, 1, 5, 6, 4, 9, 7, 8],
          [1, 3, 8, 5, 4, 6, 2, 7, 9],
          [2, 3, 1, 5, 6, 4, 9, 7, 8]
      ];

      //名前
      var name = [
        "aaa",
        "bbb",
        "ccc",
        "ddd",
        "afa",
        "fda",
        "gaa",
        "fda",
        "gaa"
      ];

      //ビンゴした数
      var sumBingo = new Array(8).fill(0);

      //一度ビンゴしたかどうかフラグ
      var alreadyBingo = new Array(8).fill(false);

      //結果保持用配列
      var result = new Array(8);
      for(let y = 0; y < result.length; y++) {
        result[y] = new Array(9).fill(false);
      }

      //ビンゴカードの表示初期化
      $(document).on('click', '#initButton', function(){
        //$('#button').trigger('click', [$(this).text()]);
          $.each(arr, function(index1, arr2) {
            $('.all-bingo-card').append('<div class="wrapper col-md-2 mb-4 grid' + index1 + '"></div>')
            $('.grid' + index1).append('<p class="name-label">' + name[index1] + 'さん</p>')
            $.each(arr2, function(index2, element) {
                $('.grid' + index1).append('<div class="grid-' + index1 + '-' + index2 + '">' + element + '</div>');
              });
          });          
      });

      $(document).on('click', '.modal-close-button', function(){
        $('.modal-body').empty();
      });

      $(document).on('click', '.number-btn', function(){
          //console.log($(this).text());
          var selectNumber = $(this).text();

          var bingoFlag = false;

          $.each(arr, function(index1, arr2) {
            $.each(arr2, function(index2, element) {
                //console.log(result[index1][index2]);
                var randomWaitTime = Math.random() * 500;

                if (element == selectNumber) {
                    result[index1][index2] = true;
                    // $('.grid-' + index1 + '-' + index2).css('background','red');
                    setTimeout(function(){
                        $('.grid-' + index1 + '-' + index2).addClass('check-square');
                    },randomWaitTime);

                    // 結果格納
                    //result[index1][index2] = true;
                }
              });
          }); 
          
          $.each(result, function(i, resultLine) {
            var count = 0;
            $.each(scanLine, function(s, target) {
              if (resultLine[target[0]] && resultLine[target[1]] && resultLine[target[2]]) {
                console.log(target[0] + '-' + target[1] + '-' + target[2] + '-')
                //console.log('.grid-' + index1 + '-' + target[0]);
                setTimeout(function(){
                  $('.grid-' + i+ '-' + target[0]).css('background-color','green');
                  $('.grid-' + i + '-' + target[1]).css('background-color','green');
                  $('.grid-' + i + '-' + target[2]).css('background-color','green');
                },1000);
                count++;
              }
            });

            if (count > 0) {
              
              // 初ビンゴの時
              if (alreadyBingo[i] == false) {
                $('.modal-body').append('<p class="winner">' + name[i] + 'さん</p>');
              }
              
              if (alreadyBingo[i] == false) {
                alreadyBingo[i] = true;
                bingoFlag = true;
              } 
            }

            sumBingo[i] = count;
          });

          if (bingoFlag == true) {
            setTimeout(function(){
              $('.modal').modal('show')
            },1500);
          }
      });
    });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
  </body>
</html>